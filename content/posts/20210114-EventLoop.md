---
title: 🌐 JS 이벤트 루프란?
description: 뭐가 그렇게 특별한데?
tags: "웹"
date: "2021-01-14"
---

https://www.youtube.com/watch?v=8aGhZQkoFbQ

상기 영상을 참고해 정리한 글이다.

자바스크립트는 "싱글 쓰레드", "논 블로킹", "비동기", "병렬성"을 지닌 언어라고 한다.

그럼 V8을 살펴보자. V8은 "콜 스택", "이벤트 루프", "콜백 큐", "API"를 가진다. 그리고 "힙"과 "콜 스택"을 가진다.

크롬을 키면 V8 브라우저가 자바스크립트 코드를 이런 특징으로 실행한다는 것이다.

# 자바스크립트 런타임

자바스크립트 런타임의 메모리 구조를 살펴보자. 콜 스택은 여느 컴퓨터 구조에서 그렇듯 파라미터나 함수를 실행할 때 마다 늘었다가 줄어들고, 힙에는 동적 할당이 일어난다.

`웹 API`들은 DOM, ajax, setTimeout 등을 처리하고, `콜백 큐`는 onClick, onLoad, onDone과 같은 이벤트를 처리한다.

## 이벤트 루프

`이벤트 루프`는 이들을 순회하며 일들을 처리한다.

## 싱글 쓰레드

여기서 `싱글 쓰레드`의 의미가 등장한다. `싱글 쓰레드`는 한번에 하나의 `콜 스택`만을 처리한다는 뜻이다.

## 블로킹

한번에 하나의 일을 처리하는데, 그 일이 엄청 오래걸린다고 해보자. 그럼 그것이 끝날때까지 굳이 기다려야 할까? 이 때 `비동기 콜백`을 활용할 수 있다. 코드를 실행하고, 콜백을 주고, 그냥 다시 돌아와서 원래 하던 일을 처리한다. 여전히 `싱글 쓰레드`이다. 대신 일이 완료되면 큐에 저장되어있던 `콜백`함수가 실행되어 이후의 처리를 할 수 있게 되는 것이다.

## 이벤트 루프와 병렬성(concurrency)

이것이 가능한 것이 바로 이벤트 루프 덕분이다!

자바스크립트는 실제로 한번에 하나의 일을 처리하는 것이 아니다. 자바스크립트는 API에 일을 맡기게 되고, 이 API들은 다른 쓰레드를 통해 실행된다.

이벤트 루프는 콜스택 -> 웹 API -> 웹 API 완료 후 콜백 -> 태스크 큐 순서로 계속해서 루프를 돈다. 이 때 태스크 큐는 콜 스택으로 우선순위를 가지며 들어올 수 있다.

그렇기 때문에 병렬성을 유지할 수 있다.

### 후기

컨퍼런스를 보면 글로는 이해하기 어려운걸 참 쉽게도 설명해주는 프레젠테이션이 많은것 같다. 이런곳에 참가하다보면 자기 분야의 이해도가 안늘래야 안늘 수가 없을듯하다.





