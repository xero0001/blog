---
title: 🦕 OPERATING SYSTEM CONCEPTS - 2. 시스템 구조
description: 공룡책 정리하기
date: "2020-12-12S02"
tags: "운영체제"
---

# 1. OS 서비스

운영체제는 사용자와 시스템에게 다양한 서비스를 제공한다.

![OS Structure](os/osstructure.jpg)

- **UI(User Interface):** 사용자가 편리한 상태의 인터페이스를 제공하는 것. CUI나 GUI가 주로 사용되고, 이를 제공하는 프로그램을 Shell이라고 부른다.
- **프로그램 실행(Program execution):** 시스템은 폰 노이만 구조에 따라 프로그램을 메모리에 로드하고, 이를 실행할 수 있고, 끝낼 수 있어야한다.
- **입출력 명령(I/O operations):** 만약 프로그램이 입출력을 필요로한다면, 운영체제는 입출력 명령을 수행해야 한다. 이때 효율과 보안을 위해 운영체제는 사용자가 직접 입출력 장치를 조작하지 않고, 자신을 거치도록한다.
- **파일 시스템 조작(File-system manipulation):** 파일을 쓰고, 읽고, 만들고, 지운다. 또한 권한이 없는 사용자가 파일에 접근하지 못하도록 막기도 한다.
- **통신(Communications):** 어떤 프로세스가 다른 프로세스와 정보를 교환해야 하는 상황에서 운영체제는 공유 메모리(Shared memory)나 메세지 패싱(Message passing)이라는 방법을 사용한다.
  - 공유 메모리는 여러개의 프로세스가 메모리의 한 부분을 공유하도록 하는 것.
  - 메세지 패싱은 프로세스 간에 정보 패킷(Packets)을 주고 받는 것을 말하는데, 공유 메모리방식에 비해 느리다.
- **에러 탐지(Error detection):** 운영체제는 CPU나 메모리와 같은 하드웨어, 입출력장치, 그리고 사용자 프로그램 등에서 일어나는 에러를 탐지하고, 바로 잡아야 한다.

운영체제는 사용자에게 직접적인 도움은 안 되지만, 시스템을 위한 작업도 수행한다.

- **자원 할당(Resource allocation):** 여러 사용자가 적절한 상한선만큼의 자원을 할당받는것.
- **회계(Accounting):** 누가 얼마나 많은 자원을 사용했는지를 정확히 추적하는 것이 회계이다.
- **보호와 보안(Protection and security):** 어떤 프로세스가 다른 사용자의 프로세스나 운영체제를 방해하면 안되며, 자신의 자원이 아닌 것을 마음대로 해서는 안된다. 이를 방어하는것이 보호이며, 사용자들의 신분을 정확히 판별하는것이 보안이다.

# 2. 시스템 콜

시스템 콜은 커널의 서비스를 사용자가 쉽게 사용할 수 있도록 하는 것이다. 시스템 콜이 호출되면 이를 처리하는 명령어는 커널 레벨에서 수행되기 때문에 모드 비트가 0이 된다.

![System Call](os/systemcall.jpg)

사용자 프로그램이 디스크에 있는 파일을 연다는 것은 파일 시스템에 접근한다는 의미다. 시스템에 접근하기 위해서는 커널 모드로 전환되어야 하는데, 이때 시스템 콜을 사용한다. 메모리의 특정 주소 범위에는 어떤 동작들이 할당되어 있다. 이것을 시스템 콜 테이블(System call table)이라고 부르며, 인터럽트 벡터(Interrupt vector)라고도 부른다. 예를 들어 fopen() 함수를 호출한다면, 운영체제는 파일을 여는 함수를 찾기 위해 시스템 콜 테이블을 참조한다. 시스템 콜 테이블은 메모리 주소의 모음인데, 해당 메모리 주소는 인터럽트 서비스 루틴(Interrupt service routine)을 가리키고 있다. 인터럽트 서비스 루틴은 일반적으로 C로 짜여진 코드이며, 시스템 콜 테이블이 가리키는 특정 메모리 주소가 구체적으로 어떤 동작을할지 정의해놓은 것이다.

시스템 콜에는 fork(), exit(), read(), write()와 같은 함수들이 있다. 하지만 개발자가 이것을 직접 조작하는 것은 불편하고 위험한 일이므로, 표준 라이브러리(Standard library)를 사용한다. stdio.h가 그 일종이다.

시스템 콜을 위해 파라미터를 운영체제에 전달하는 방법은 3가지가 있다.

- **Call by value:** 매개변수의 값 자체를 복사해서 CPU 레지스터에 전달한다.
- **Call by reference:** 값의 메모리 주소를 전달한다. 많은 값을 전달한다면 이렇게 하는 것이 효율적이다.
- 프로그램이 스택에 파라미터를 push하고, 운영체제가 pop한다.

# 3. 시스템 콜의 종류

시스템 콜은 크게 6가지로 분류할 수 있다.

- **프로세스 제어:** 프로세스를 실행, 로드하거나 끝내는 기능. end, abort, load, execute
- **파일 관리:** 파일을 생성하고, 지우고, 열고 쓰는 기능. create, delete, open, close, read, write
- **장치 관리:** 장치에 읽고 읽는 등의 기능. read, write, request, release
- **정보 보관:** 프로그램과 OS간 단순히 정보 전달을 하는 기능. get/set time or date
- **통신:** 메시지를 전달하는 기능. send/receive messages, transfer status
- **보호:** 접근 권한을 조절하는 기능.

# 4. 링커와 로더

코드를 실행가능한 프로그램으로 변환하여 실행하는 과정은 다음을 거친다.

![Link Loader](os/linkloader.jpg)

- 컴파일러: 소스파일이 오브젝트 파일로 변환함.
- 링커: 다른 오브젝트 파일과 함께 소스 오브젝트 파일을 실행 가능한 파일로 변환함.
- 로더: 실행시 다른 동적 라이브러리들과 결함해 프로그램을 메모리에 적재함.

# 5. OS 구조

현대 운영체제는 계층을 나눠서 시스템을 관리한다.

## 5.1 모놀리식 커널

MS-DOS나 과거의 UNIX와 같은 전통적인 운영체제들은 필요한 모든 기능이 하나의 프로그램으로 합쳐진 형태였다. 하드웨어 계층 위, 사용자 계층 아래에 있는 커널이 모든 기능을 제공했다. 이러한 모놀리딕(Monolithic) 구조는 구현과 유지보수가 쉽지 않았다. 또한 서브기능 중 하나가 멈추면 모든 프로그램이 멈추었다.

## 5.2 레이어드 커널

![Layered Kernel](os/layeredkernel.jpg)

운영체제를 더 세분화해 계층을 분리한 것이 계층적 접근(Layered approach) 방식이다. 가장 아래에 있는 계층(레이어 0)은 하드웨어고, 가장 높은 계층(레이어 N)은 사용자 인터페이스다. 각 계층은 하위계층의 기능들만을 사용할 수 있도록 상위계층을 구현하는 방식이다.

이 방식은 유지보수가 아주 편한데, 하나의 계층에만 신경쓰면 다른 계층에는 아무런 신경을 쓰지 않아도 되기 때문이다.

그러나 설계단계의 중요성이 매우 높아졌고, 파라미터가 여러 계층을 통과해야하는 경우에는 오버헤드가 발생하여 비효율적이기도 하다.

## 4.3 마이크로커널

마이크로커널(Microkernel)은 커널에서 핵심적인 요소만 남긴 가벼운 커널을 말한다. 마이크로커널은 메모리 관리와 함께 프로그램과 서비스간의 통신을 매개하는 역할을 주로 한다.

## 4.4 모듈

마이크로 커널에서 커널을 최소화하면서 필요한 기능들을 모듈로 따로 빼낸 방식이 모듈형 커널이다. 모듈에서는 에러가 발생해도 커널은 정상동작하며, 파라미터 전달에 있어서도 모듈로 직접 전달할 수 있어 오버헤드 문제가 없다. 확장성도 용이하다.

모듈은 커널을 확장하기 위한 기술로, OOP에서 말하는 그 모듈화와 같은 개념이다. 프로세스에 실시간으로 모듈을 붙여 작동시킬 수 있고, 각 기능들을 독립적으로 관리할 수 있어 효과적으로 시스템을 유지할 수 있다. 장치 드라이버는 모두 모듈로 구현되어 있으며, 윈도우에서 .dll파일이 바로 모듈이다.

## 4.5 하이브리드 시스템

스마트폰은 OS 구조의 최신판이라고 할 수 있다. 하이브리드 시스템은 커널의 핵심만 남기고 나머지는 따로 구현한 시스템이다. OS X의 경우 BSD가 핵심이지만 나머지는 모두 애플이 자체 구현했다. 안드로이드는 리눅스 커널위에 자체 구현한 라이브러리를 올린 시스템이다.

# References

[🦕 공룡책으로 정리하는 운영체제 Ch.2 (parksb.github.io) - 9판](https://parksb.github.io/article/6.html)

[운영체제 정리 🦖 ch02. 운영체제 구조](https://aerocode.net/371?category=798030)
